classdef HEKAdat
    properties
        data
        tAxis
        waveNames
        dirData='/Users/angueyraaristjm/Documents/DataGxTx/HEKAmatlabExports/';
        dirSave='/Users/angueyraaristjm/Documents/DataGxTx/HEKAmatlabParsed/';
        dirFile
        tags
%             bad %bad data
%             ccc %blanks
%             ooo %normal
%             coc %toxin bound
%             zzz %all others
%               coo %toxin left
%               cco %toxin left too
%               occ %inactivation?
%               ooc %inactivation?
%               oco %weird one
    end
    
    properties (SetAccess = private)
        initalparseFlag = 0;
    end
    
    methods
        function hekadat=HEKAdat(dirFile)
            if ~ischar(dirFile)
                error('dirFile must be a string (e.g. ''2015_06_23.mat'')')
            else
                if exist(sprintf('%s%s.mat',hekadat.dirSave,dirFile),'file')==2
                    temp_hekadat=load(sprintf('%s%s',hekadat.dirSave,dirFile));
                    hekadat=temp_hekadat.hekadat;
                else
                    if exist(sprintf('%s%s.mat',hekadat.dirData,dirFile),'file')==2
                        hekadat.dirFile=dirFile;
                        hekadat=HEKAparse(hekadat);
                    else
                        error('file <%s.mat> does not exist in <%s>',dirFile,hekadat.dirData)
                    end
                end
            end
        end 
        
        function hekadat=HEKAparse(hekadat)
            HEKAexport=load(sprintf('%s/%s.mat',hekadat.dirData,hekadat.dirFile));
            fnames=fieldnames(HEKAexport);
            
            hekadat.waveNames=regexprep(regexprep(fnames,'Trace','e'),'_1$','');
            hekadat.tAxis=HEKAexport.(fnames{1})(:,1)';
            hekadat.data=NaN(size(fnames,1),size(hekadat.tAxis,2));
            for i=1:size(fnames,1)
                hekadat.data(i,:)=HEKAexport.(fnames{i})(:,2)*1e12; %transform into pA
            end
            hekadat.initalparseFlag=1;
            hekadat.tags=cell(size(hekadat.waveNames));
        end
        
        function hekadat=HEKAsave(hekadat)
           save(sprintf('%s%s',hekadat.dirSave,hekadat.dirFile),'hekadat') 
        end
        
        function matches=HEKAtagfind(hekadat,tag)
            tagfindfx=@(tag)(@(taglist)(strcmp(tag,taglist)));
            matches=cellfun(tagfindfx(tag),hekadat.tags);
        end
        
        function tagmean=HEKAtagmean(hekadat,tag)
            tagmean=mean(hekadat.data(hekadat.HEKAtagfind(tag),:));
        end
        
        function stim=HEKAstim(hekadat)
            stimt=[0 0.1 0.20 0.22 0.72 0.74 0.84];
            stim=;
        end
    end
end