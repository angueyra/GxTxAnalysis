classdef gxtx_iAnalysisPlots<iAnalysisGUI
    properties
    end
    
    methods
        % Constructor (gui objects and initial plotting)
        function hGUI=gxtx_iAnalysisPlots(iA,params,fign) 
%           params=checkStructField(params,'PlotNow',1);
          hGUI@iAnalysisGUI(iA,params,fign);
          
          bw=.065;
          bh=0.08;
          bl=0.995-bw;
          
          pleft=.235;
          pwidth=.48;
          pheight=.42;
          ptop=.57;
          ptop2=.14;
          
          % Save Button
          lockBt=struct('Position', [bl-.02 .03 bw+.02 bh],'String','Lock&Save');
          hGUI.lockButton(lockBt);
          

          % Sliders
          lSlide=struct('tag','leftSlider','Position',[pleft-.015 pheight+.05 pwidth+.03 .05]);
          lSlide.Min=1;
          lSlide.Max=n;
          lSlide.Value=floor(lSlide.Min);
          lSlide.SliderStep=[1/n 20/n];
          lSlide.Callback=@hGUI.lSlideCall;
          hGUI.createSlider(lSlide);
          
          rSlide=struct('tag','rightSlider','Position',[pleft-.015 pheight+.02 pwidth+.03 .05]);
          rSlide.Min=1;
          rSlide.Max=iA.n;
          rSlide.Value=floor(rSlide.Max);
          rSlide.SliderStep=[1/n 20/n];
          rSlide.Callback=@hGUI.lSlideCall;
          hGUI.createSlider(rSlide);
          
          % odt Fit button
          odtfitBt=struct('tag','odtFit','Position',[pleft+pwidth+0.02 pheight+.03 .065 .08]);
          odtfitBt.Callback=@hGUI.odtfitCall;
          hGUI.createButton(odtfitBt);
          
                    
          % Histograms and fits
          plotEvolution=struct('Position',[pleft ptop pwidth pheight],'tag','plotHist');
          plotEvolution.YLim=[0 1.05];
          plotEvolution.XLim=[1 iA.n];
          hGUI.makePlot(plotEvolution);
          hGUI.labelx(hGUI.figData.plotHist,'n');
          hGUI.labely(hGUI.figData.plotHist,'Cum. Prob.');
          
          %left line
          lH=line([lSlide.Value lSlide.Value],plotEvolution.YLim,'Parent',hGUI.figData.plotHist);
          set(lH,'LineStyle','-','Marker','none','LineWidth',2,'MarkerSize',5,'Color',[1 .75 .75])
          set(lH,'DisplayName','leftLine')
          %right line
          lH=line([rSlide.Value rSlide.Value],plotEvolution.YLim,'Parent',hGUI.figData.plotHist);
          set(lH,'LineStyle','-','Marker','none','LineWidth',2,'MarkerSize',5,'Color',[.75 .75 1])
          set(lH,'DisplayName','rightLine')
          
          %State Evolution
          ooo=iA.IAOtagfind('ooo');
          coc=iA.IAOtagfind('coc');
          ccc=iA.IAOtagfind('ccc');
          nwaves=[1:iA.n]';
          % ooo cum prob
          oooH=line(nwaves,cumsum(ooo)./(nwaves),'Parent',plotEvolution);
          set(oooH,'Marker','.','LineStyle','-','LineWidth',1,'Color','b')
          % coc cum prob
          cocH=line(nwaves,cumsum(coc)./(nwaves),'Parent',plotEvolution);
          set(cocH,'Marker','.','LineStyle','-','LineWidth',1,'Color','r')
          % ccc cum prob
          cccH=line(nwaves,cumsum(ccc)./(nwaves),'Parent',plotEvolution);
          set(cccH,'Marker','.','LineStyle','none','LineWidth',1,'Color',[.5 .5 .5])
          
          hGUI.updatePlots();
        end
        
        function updatePlots(hGUI,~,~)
            hGUI.disableGui;
            
            hGUI.enableGui;
        end
        
        function fittingCall(hGUI,~,~)
            hGUI.disableGui;
            
            hGUI.enableGui;
        end
        
        function lockButtonCall(hGUI,~,~)
            hGUI.disableGui;
            
            hGUI.enableGui;
        end
        
        function lSlideCall(hGUI,~,~)
            hGUI.disableGui;
            lValue=get(hGUI.figData.leftSlider,'Value');
            rValue=get(hGUI.figData.rightSlider,'Value');
            
            lH=findobj('DisplayName','leftLine');
            set(lH,'XData',[lValue lValue])
            rH=findobj('DisplayName','rightLine');
            set(rH,'XData',[rValue rValue])
            hGUI.enableGui;
        end
        
        function wSlideCall(hGUI,~,~)
            hGUI.disableGui;
            lValue=get(hGUI.figData.wleftSlider,'Value');
            rValue=get(hGUI.figData.wrightSlider,'Value');
            lTime=hGUI.hekadat.stAxis(ceil(lValue));
            rTime=hGUI.hekadat.stAxis(floor(rValue));
            
            lH=findobj('DisplayName','wleftLine');
            set(lH,'XData',[lTime lTime])
            rH=findobj('DisplayName','wrightLine');
            set(rH,'XData',[rTime rTime])
            hGUI.enableGui;
        end
        
        
    end
    
    methods (Static=true)
         
    end
end